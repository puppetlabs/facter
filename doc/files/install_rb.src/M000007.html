<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html 
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html>
<head>
  <title>prepare_installation (install.rb)</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
  <link rel="stylesheet" href="../.././rdoc-style.css" type="text/css" media="screen" />
</head>
<body class="standalone-code">
  <pre><span class="ruby-comment cmt"># File install.rb, line 145</span>
<span class="ruby-keyword kw">def</span> <span class="ruby-identifier">prepare_installation</span>
  <span class="ruby-comment cmt"># Only try to do docs if we're sure they have rdoc</span>
  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$haverdoc</span>
    <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">rdoc</span>  = <span class="ruby-keyword kw">true</span>
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">is_windows?</span>
      <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">ri</span>  = <span class="ruby-keyword kw">false</span>
    <span class="ruby-keyword kw">else</span>
      <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">ri</span>  = <span class="ruby-keyword kw">true</span>
    <span class="ruby-keyword kw">end</span>
  <span class="ruby-keyword kw">else</span>
    <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">rdoc</span>  = <span class="ruby-keyword kw">false</span>
    <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">ri</span>  = <span class="ruby-keyword kw">false</span>
  <span class="ruby-keyword kw">end</span>


  <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">$haveman</span>
    <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">man</span> = <span class="ruby-keyword kw">true</span>
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">is_windows?</span>
      <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">man</span>  = <span class="ruby-keyword kw">false</span>
    <span class="ruby-keyword kw">end</span>
  <span class="ruby-keyword kw">else</span>
    <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">man</span> = <span class="ruby-keyword kw">false</span>
  <span class="ruby-keyword kw">end</span>

  <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">tests</span> = <span class="ruby-keyword kw">true</span>

  <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">options</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">opts</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">banner</span> = <span class="ruby-node">&quot;Usage: #{File.basename($0)} [options]&quot;</span>
    <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span> <span class="ruby-value str">&quot;&quot;</span>
    <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">'--[no-]rdoc'</span>, <span class="ruby-value str">'Prevents the creation of RDoc output.'</span>, <span class="ruby-value str">'Default on.'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">onrdoc</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">rdoc</span> = <span class="ruby-identifier">onrdoc</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">'--[no-]ri'</span>, <span class="ruby-value str">'Prevents the creation of RI output.'</span>, <span class="ruby-value str">'Default off on mswin32.'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">onri</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">ri</span> = <span class="ruby-identifier">onri</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">'--[no-]man'</span>, <span class="ruby-value str">'Presents the creation of man pages.'</span>, <span class="ruby-value str">'Default on.'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">onman</span><span class="ruby-operator">|</span>
    <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">man</span> = <span class="ruby-identifier">onman</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">'--[no-]tests'</span>, <span class="ruby-value str">'Prevents the execution of unit tests.'</span>, <span class="ruby-value str">'Default on.'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ontest</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">tests</span> = <span class="ruby-identifier">ontest</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">'--destdir[=OPTIONAL]'</span>, <span class="ruby-value str">'Installation prefix for all targets'</span>, <span class="ruby-value str">'Default essentially /'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">destdir</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">destdir</span> = <span class="ruby-identifier">destdir</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">'--bindir[=OPTIONAL]'</span>, <span class="ruby-value str">'Installation directory for binaries'</span>, <span class="ruby-value str">'overrides RbConfig::CONFIG[&quot;bindir&quot;]'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">bindir</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">bindir</span> = <span class="ruby-identifier">bindir</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">'--sbindir[=OPTIONAL]'</span>, <span class="ruby-value str">'Installation directory for system binaries'</span>, <span class="ruby-value str">'overrides RbConfig::CONFIG[&quot;sbindir&quot;]'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sbindir</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">sbindir</span> = <span class="ruby-identifier">sbindir</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">'--sitelibdir[=OPTIONAL]'</span>, <span class="ruby-value str">'Installation directory for libraries'</span>, <span class="ruby-value str">'overrides RbConfig::CONFIG[&quot;sitelibdir&quot;]'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sitelibdir</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">sitelibdir</span> = <span class="ruby-identifier">sitelibdir</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">'--mandir[=OPTIONAL]'</span>, <span class="ruby-value str">'Installation directory for man pages'</span>, <span class="ruby-value str">'overrides RbConfig::CONFIG[&quot;mandir&quot;]'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">mandir</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">mandir</span> = <span class="ruby-identifier">mandir</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">'--quick'</span>, <span class="ruby-value str">'Performs a quick installation. Only the'</span>, <span class="ruby-value str">'installation is done.'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">quick</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">rdoc</span>   = <span class="ruby-keyword kw">false</span>
      <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">ri</span>   = <span class="ruby-keyword kw">false</span>
      <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">tests</span>  = <span class="ruby-keyword kw">false</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on</span>(<span class="ruby-value str">'--full'</span>, <span class="ruby-value str">'Performs a full installation. All'</span>, <span class="ruby-value str">'optional installation steps are run.'</span>) <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">full</span><span class="ruby-operator">|</span>
      <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">rdoc</span>   = <span class="ruby-keyword kw">true</span>
      <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">ri</span>   = <span class="ruby-keyword kw">true</span>
      <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">tests</span>  = <span class="ruby-keyword kw">true</span>
    <span class="ruby-keyword kw">end</span>
    <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">separator</span>(<span class="ruby-value str">&quot;&quot;</span>)
    <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">on_tail</span>(<span class="ruby-value str">'--help'</span>, <span class="ruby-value str">&quot;Shows this help text.&quot;</span>) <span class="ruby-keyword kw">do</span>
      <span class="ruby-identifier">$stderr</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">opts</span>
      <span class="ruby-identifier">exit</span>
    <span class="ruby-keyword kw">end</span>

    <span class="ruby-identifier">opts</span>.<span class="ruby-identifier">parse!</span>
  <span class="ruby-keyword kw">end</span>

  <span class="ruby-identifier">tmpdirs</span> = [<span class="ruby-constant">ENV</span>[<span class="ruby-value str">'TMP'</span>], <span class="ruby-constant">ENV</span>[<span class="ruby-value str">'TEMP'</span>], <span class="ruby-value str">&quot;/tmp&quot;</span>, <span class="ruby-value str">&quot;/var/tmp&quot;</span>, <span class="ruby-value str">&quot;.&quot;</span>]

  <span class="ruby-identifier">version</span> = [<span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">&quot;MAJOR&quot;</span>], <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">&quot;MINOR&quot;</span>]].<span class="ruby-identifier">join</span>(<span class="ruby-value str">&quot;.&quot;</span>)
  <span class="ruby-identifier">libdir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">&quot;libdir&quot;</span>], <span class="ruby-value str">&quot;ruby&quot;</span>, <span class="ruby-identifier">version</span>)

  <span class="ruby-comment cmt"># Mac OS X 10.5 and higher declare bindir and sbindir as</span>
  <span class="ruby-comment cmt"># /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/bin</span>
  <span class="ruby-comment cmt"># /System/Library/Frameworks/Ruby.framework/Versions/1.8/usr/sbin</span>
  <span class="ruby-comment cmt"># which is not generally where people expect executables to be installed</span>
  <span class="ruby-comment cmt"># These settings are appropriate defaults for all OS X versions.</span>
  <span class="ruby-keyword kw">if</span> <span class="ruby-constant">RUBY_PLATFORM</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/^universal-darwin[\d\.]+$/</span>
    <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">'bindir'</span>] = <span class="ruby-value str">&quot;/usr/bin&quot;</span>
    <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">'sbindir'</span>] = <span class="ruby-value str">&quot;/usr/sbin&quot;</span>
  <span class="ruby-keyword kw">end</span>

  <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">bindir</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">bindir</span> = <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">bindir</span>
  <span class="ruby-keyword kw">else</span>
    <span class="ruby-identifier">bindir</span> = <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">'bindir'</span>]
  <span class="ruby-keyword kw">end</span>

  <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">sbindir</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">sbindir</span> = <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">sbindir</span>
  <span class="ruby-keyword kw">else</span>
    <span class="ruby-identifier">sbindir</span> = <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">'sbindir'</span>]
  <span class="ruby-keyword kw">end</span>

  <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">sitelibdir</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">sitelibdir</span> = <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">sitelibdir</span>
  <span class="ruby-keyword kw">else</span>
    <span class="ruby-identifier">sitelibdir</span> = <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">&quot;sitelibdir&quot;</span>]
    <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitelibdir</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">sitelibdir</span> = <span class="ruby-identifier">$:</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span><span class="ruby-operator">|</span> <span class="ruby-identifier">x</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp re">/site_ruby/</span> }
      <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">sitelibdir</span>.<span class="ruby-identifier">nil?</span>
        <span class="ruby-identifier">sitelibdir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">libdir</span>, <span class="ruby-value str">&quot;site_ruby&quot;</span>)
      <span class="ruby-keyword kw">elsif</span> <span class="ruby-identifier">sitelibdir</span> <span class="ruby-operator">!~</span> <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">quote</span>(<span class="ruby-identifier">version</span>)
        <span class="ruby-identifier">sitelibdir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">sitelibdir</span>, <span class="ruby-identifier">version</span>)
      <span class="ruby-keyword kw">end</span>
    <span class="ruby-keyword kw">end</span>
  <span class="ruby-keyword kw">end</span>

  <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">not</span> <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">mandir</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">mandir</span> = <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">mandir</span>
  <span class="ruby-keyword kw">else</span>
    <span class="ruby-identifier">mandir</span> = <span class="ruby-constant">RbConfig</span><span class="ruby-operator">::</span><span class="ruby-constant">CONFIG</span>[<span class="ruby-value str">'mandir'</span>]
  <span class="ruby-keyword kw">end</span>

  <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">destdir</span> = <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">destdir</span>)
    <span class="ruby-identifier">bindir</span> = <span class="ruby-identifier">join</span>(<span class="ruby-identifier">destdir</span>, <span class="ruby-identifier">bindir</span>)
    <span class="ruby-identifier">sbindir</span> = <span class="ruby-identifier">join</span>(<span class="ruby-identifier">destdir</span>, <span class="ruby-identifier">sbindir</span>)
    <span class="ruby-identifier">mandir</span> = <span class="ruby-identifier">join</span>(<span class="ruby-identifier">destdir</span>, <span class="ruby-identifier">mandir</span>)
    <span class="ruby-identifier">sitelibdir</span> = <span class="ruby-identifier">join</span>(<span class="ruby-identifier">destdir</span>, <span class="ruby-identifier">sitelibdir</span>)

    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">makedirs</span>(<span class="ruby-identifier">bindir</span>)
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">makedirs</span>(<span class="ruby-identifier">sbindir</span>)
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">makedirs</span>(<span class="ruby-identifier">mandir</span>)
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">makedirs</span>(<span class="ruby-identifier">sitelibdir</span>)
  <span class="ruby-keyword kw">end</span>

  <span class="ruby-identifier">tmpdirs</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">bindir</span>

  <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">tmp_dirs</span> = <span class="ruby-identifier">tmpdirs</span>.<span class="ruby-identifier">compact</span>
  <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">site_dir</span> = <span class="ruby-identifier">sitelibdir</span>
  <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">bin_dir</span>  = <span class="ruby-identifier">bindir</span>
  <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">sbin_dir</span> = <span class="ruby-identifier">sbindir</span>
  <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">lib_dir</span>  = <span class="ruby-identifier">libdir</span>
  <span class="ruby-constant">InstallOptions</span>.<span class="ruby-identifier">man_dir</span>  = <span class="ruby-identifier">mandir</span>
<span class="ruby-keyword kw">end</span></pre>
</body>
</html>